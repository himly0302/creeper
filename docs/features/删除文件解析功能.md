# 删除文件解析功能 - 需求文档

> 生成时间：2025-12-05
> 基于项目：Creeper
> 技术栈：Python 3.8+ + asyncio + Redis + LLM API

---

## 项目概况

**技术栈**：Python 3.8+ + asyncio + Redis + OpenAI SDK + Playwright
**架构模式**：模块化分层架构
**代码风格**：snake_case 命名 / 中文注释 / 类型提示

---

## 改动点

### 要实现什么
- 核心功能 1：完全删除文件解析功能（parser.py 和相关模块）
- 核心功能 2：清理所有相关文件、配置、文档和测试
- 核心功能 3：移除相关缓存数据和配置项

### 与现有功能的关系
- 依赖现有模块：file_aggregator.py（FileScanner 类被复用）- 需要评估是否保留
- 集成位置：作为独立工具存在，删除不影响爬虫和整合功能

### 新增依赖（如有）
- 无（删除操作）

---

## 实现方案

### 需要删除的文件
```
parser.py  # CLI 入口点
src/file_parser.py  # 核心解析逻辑
tests/file_parser/  # 测试目录（包含所有子文件）
docs/features/文件解析功能.md  # 需求文档
data/parser_cache.json  # 本地缓存文件（如有）
prompts/parser/  # 解析模板目录（包含所有 .txt 文件）
```

### 需要修改的文件
```
src/file_aggregator.py  # 检查 FileScanner 是否被 parser.py 独占使用
src/prompt_templates.py  # 删除解析模板相关代码
CLAUDE.md  # 删除文件解析相关说明和命令
README.md  # 删除文件解析功能介绍
CHANGELOG.md  # 添加删除记录
requirements.txt  # 如有 parser 独占依赖则删除
.env.example  # 删除解析相关配置项注释
```

### 实施步骤

**步骤 1：环境准备**
- [ ] 确认没有正在运行的解析任务
- [ ] 备份重要的解析结果文件（如有）

**步骤 2：核心删除**
- [ ] 删除 parser.py CLI 入口文件
- [ ] 删除 src/file_parser.py 核心模块
- [ ] 删除 tests/file_parser/ 测试目录
- [ ] 删除 prompts/parser/ 模板目录
- [ ] 删除 docs/features/文件解析功能.md
- [ ] 删除 data/parser_cache.json（如有）

**步骤 3：清理相关代码**
- [ ] 检查并清理 src/file_aggregator.py 中的 FileScanner 依赖
- [ ] 清理 src/prompt_templates.py 中的解析模板加载逻辑
- [ ] 清理配置文件中的解析相关项

**步骤 4：更新文档**
- [ ] 更新 CLAUDE.md：删除解析相关命令、配置和说明
- [ ] 更新 README.md：删除文件解析功能介绍
- [ ] 更新 CHANGELOG.md：记录删除操作

**步骤 5：清理缓存**
- [ ] 清理 Redis 中的 parser 相关缓存：`redis-cli -n 1 KEYS "creeper:parser:*" | xargs redis-cli -n 1 DEL`
- [ ] 删除本地缓存文件 data/parser_cache.json

**步骤 6：测试**
- [ ] 测试爬虫功能正常工作
- [ ] 测试文件整合功能正常工作
- [ ] 确认 parser.py 命令不再可用

**步骤 7：文档更新**（必须执行）

使用 **Edit 工具**按以下标准判断并更新：

| 文档 | 需要更新 | 不需要更新 |
|------|----------|-----------|
| **CHANGELOG.md** | 每次功能完成后必须更新 | - |
| **README.md** | 删除文件解析功能介绍 | - |
| **CLAUDE.md** | 删除解析相关命令、配置、使用说明 | - |

**CHANGELOG.md 更新**（在 `## [Unreleased]` 下添加）：
```markdown
### Removed
- **文件解析功能**：完全删除文件解析器及相关功能
  - 删除 parser.py 命令行工具
  - 删除 src/file_parser.py 核心模块
  - 删除 9 个解析模板文件
  - 删除相关测试和文档
  - 相关文件：`parser.py`, `src/file_parser.py`, `prompts/parser/`, `tests/file_parser/`
```

**版本号规则**：删除功能 → MINOR 版本（如果 API 兼容）或 PATCH（小改进）

**步骤 8：提交代码**（必须执行）

使用 **Bash 工具**执行：
```bash
git add .
git commit -m "feat: 删除文件解析功能

- 删除 parser.py 和相关模块
- 清理解析模板和测试文件
- 更新文档说明

🤖 Generated with [Claude Code](https://claude.com/claude-code)

Co-Authored-By: Claude <noreply@anthropic.com>"
```

**步骤 9：自我检查**
- [ ] 文件解析功能是否完全删除
- [ ] 爬虫和整合功能是否正常（未被破坏）
- [ ] CHANGELOG.md 是否已更新
- [ ] README.md 是否已更新
- [ ] CLAUDE.md 是否已更新
- [ "实现步骤"与"需要修改/新增的文件"是否一致
- [ ] 所有相关文件是否已提交

---

## 使用方式

### 删除后的变化
- 不再支持 `python parser.py` 命令
- `prompts/parser/` 目录下的 9 个解析模板将被删除
- 文件夹级别的单文件解析能力将消失
- 保留爬虫（creeper.py）和整合（aggregator.py）功能

### 功能替代方案
如需要文件处理功能，可以使用：
1. **文件整合功能**（aggregator.py）：多文件整合为单个文档
2. **外部工具**：如 Pandoc、其他 Python 脚本等

---

## 注意事项

**技术风险**：
- 确保 FileScanner 类不被其他模块需要（评估后再删除）
- 检查是否有其他脚本依赖 parser.py

**兼容性**：
- 这是一个破坏性变更，需要更新版本号
- 用户需要迁移到其他文件处理方案

**数据清理**：
- 务必清理 Redis 和本地的 parser 相关缓存
- 通知用户备份重要的解析结果文件