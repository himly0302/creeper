# å›¾ç‰‡é“¾æ¥æå– - éœ€æ±‚æ–‡æ¡£

> ç”Ÿæˆæ—¶é—´ï¼š2025-12-08
> åŸºäºé¡¹ç›®ï¼šCreeper v1.9.2
> æŠ€æœ¯æ ˆï¼šPython 3.8+ + Trafilatura + aiohttp + Playwright

---

## é¡¹ç›®æ¦‚å†µ

**æŠ€æœ¯æ ˆ**ï¼šPython 3.8+ + Trafilatura (å†…å®¹æå–) + aiohttp (å¼‚æ­¥ HTTP) + Playwright (åŠ¨æ€æ¸²æŸ“) + Redis (å»é‡ç¼“å­˜)

**æ¶æ„æ¨¡å¼**ï¼šæ¨¡å—åŒ–åˆ†å±‚æ¶æ„
- **æ•°æ®å±‚**ï¼š`parser.py` (URL è§£æ) + `dedup.py` (å»é‡)
- **çˆ¬å–å±‚**ï¼š`fetcher.py` / `async_fetcher.py` (å†…å®¹è·å–)
- **å­˜å‚¨å±‚**ï¼š`storage.py` (Markdown æ–‡ä»¶å­˜å‚¨)
- **å·¥å…·å±‚**ï¼š`url_list_mode.py` (URL åˆ—è¡¨æ¨¡å¼) + `image_downloader.py` (å›¾ç‰‡å¤„ç†)

**ä»£ç é£æ ¼**ï¼š
- ç±»åï¼šPascalCaseï¼ˆ`WebPage`, `URLListMode`ï¼‰
- æ–¹æ³•åï¼šsnake_caseï¼ˆ`process_urls()`, `webpage_to_dict()`ï¼‰
- CLI å‚æ•°ï¼šargparse é£æ ¼ï¼Œ`--kebab-case`

---

## æ”¹åŠ¨ç‚¹

### è¦å®ç°ä»€ä¹ˆ
- **æ ¸å¿ƒåŠŸèƒ½**ï¼šæ–°å¢ `--with-images` CLI æ ‡å¿—ä½ï¼Œå¯ç”¨ååœ¨ `--urls` æ¨¡å¼çš„ JSON è¾“å‡ºä¸­åŒ…å« `images` å­—æ®µ
- **ç”Ÿæ•ˆæ¡ä»¶**ï¼š`--with-images` **å¿…é¡»é…åˆ `--urls` ä½¿ç”¨**ï¼Œå•ç‹¬ä½¿ç”¨æ—¶æç¤ºé”™è¯¯
- **è¾“å‡ºæ ¼å¼å˜åŒ–**ï¼š
  ```json
  {
    "title": "é¡µé¢æ ‡é¢˜",
    "summary": "é¡µé¢æè¿°",
    "content": "é¡µé¢æ­£æ–‡å†…å®¹",
    "url": "https://example.com",
    "images": ["https://example.com/img1.png", "https://example.com/img2.jpg"]
  }
  ```

### ä¸ç°æœ‰åŠŸèƒ½çš„å…³ç³»
- **ä¾èµ–ç°æœ‰æ¨¡å—**ï¼š
  - `url_list_mode.py` - éœ€è¦ä¿®æ”¹ `webpage_to_dict()` æ–¹æ³•ï¼Œå¢åŠ  `images` å­—æ®µ
  - `image_downloader.py` - å¤ç”¨ `ImageDownloader.extract_image_urls()` æå–å›¾ç‰‡ URL
  - `cli_parser.py` - æ–°å¢ `--with-images` å‚æ•°
- **é›†æˆä½ç½®**ï¼š
  - `src/cli_parser.py:45-51` - `--urls` å‚æ•°å®šä¹‰é™„è¿‘æ·»åŠ  `--with-images`
  - `src/url_list_mode.py:93-108` - `webpage_to_dict()` æ–¹æ³•æ·»åŠ å›¾ç‰‡æå–é€»è¾‘
  - `creeper.py` - æ·»åŠ å‚æ•°ç»„åˆéªŒè¯é€»è¾‘

### æ–°å¢ä¾èµ–
- **æ— ** - å¤ç”¨ç°æœ‰ `image_downloader.py` çš„å›¾ç‰‡ URL æå–é€»è¾‘

---

## å®ç°æ–¹æ¡ˆ

### éœ€è¦ä¿®æ”¹çš„æ–‡ä»¶
```
src/cli_parser.py         # æ–°å¢ --with-images å‚æ•°
src/url_list_mode.py      # ä¿®æ”¹ webpage_to_dict() å’Œ URLListMode ç±»
creeper.py                # æ·»åŠ å‚æ•°ç»„åˆéªŒè¯ï¼Œä¼ é€’ with_images å‚æ•°
```

### éœ€è¦æ–°å¢çš„æ–‡ä»¶
```
tests/test_url_list_mode/test_with_images.py  # æµ‹è¯• --with-images åŠŸèƒ½
```

### å®æ–½æ­¥éª¤

**æ­¥éª¤ 1ï¼šç¯å¢ƒå‡†å¤‡**
- [ ] æ— éœ€å®‰è£…æ–°ä¾èµ–
- [ ] ç¡®è®¤ `tests/test_url_list_mode/` ç›®å½•å·²å­˜åœ¨

**æ­¥éª¤ 2ï¼šæ ¸å¿ƒå®ç°**
- [ ] ä¿®æ”¹ `src/cli_parser.py`ï¼š
  - åœ¨ `--urls` å‚æ•°åæ·»åŠ  `--with-images` å‚æ•°ï¼ˆ`action='store_true'`ï¼‰
  - æ·»åŠ å¸®åŠ©æ–‡æœ¬ï¼š`'æå–é¡µé¢ä¸­çš„å›¾ç‰‡é“¾æ¥(ä»…åœ¨ --urls æ¨¡å¼ä¸‹ç”Ÿæ•ˆ)'`
- [ ] ä¿®æ”¹ `src/url_list_mode.py`ï¼š
  - `URLListMode.__init__()` æ·»åŠ  `with_images: bool = False` å‚æ•°
  - `webpage_to_dict()` æ–¹æ³•ï¼šå½“ `with_images=True` æ—¶æå–å¹¶æ·»åŠ  `images` å­—æ®µ
  - å¤ç”¨ `ImageDownloader.extract_image_urls()` æˆ–ç›´æ¥ä½¿ç”¨æ­£åˆ™æå–
- [ ] ä¿®æ”¹ `creeper.py`ï¼š
  - æ·»åŠ å‚æ•°ç»„åˆéªŒè¯ï¼š`--with-images` å¿…é¡»é…åˆ `--urls` ä½¿ç”¨
  - ä¼ é€’ `with_images` å‚æ•°ç»™ `URLListMode`
- [ ] æ·»åŠ é”™è¯¯å¤„ç†ï¼šå›¾ç‰‡æå–å¤±è´¥æ—¶è¿”å›ç©ºåˆ—è¡¨ï¼Œä¸å½±å“ä¸»æµç¨‹

**æ­¥éª¤ 3ï¼šé›†æˆåˆ°ç°æœ‰ç³»ç»Ÿ**
- [ ] ä¿®æ”¹ `src/cli_parser.py`ï¼šæ·»åŠ  `--with-images` å‚æ•°å®šä¹‰
- [ ] ä¿®æ”¹ `src/url_list_mode.py`ï¼š
  - æ›´æ–° `URLListMode` ç±»æ”¯æŒ `with_images` å‚æ•°
  - æ›´æ–° `run_url_list_mode()` ä¾¿æ·å‡½æ•°
- [ ] ä¿®æ”¹ `creeper.py`ï¼š
  - åœ¨ URL åˆ—è¡¨æ¨¡å¼å¤„ç†é€»è¾‘ä¸­æ·»åŠ éªŒè¯å’Œå‚æ•°ä¼ é€’

**æ­¥éª¤ 4ï¼šæµ‹è¯•**
- [ ] æµ‹è¯• `--urls --with-images` ç»„åˆä½¿ç”¨
- [ ] æµ‹è¯•å•ç‹¬ä½¿ç”¨ `--with-images`ï¼ˆåº”æç¤ºé”™è¯¯ï¼‰
- [ ] æµ‹è¯•ä¸ä½¿ç”¨ `--with-images` æ—¶è¾“å‡ºä¸åŒ…å« `images` å­—æ®µ
- [ ] **å›å½’æµ‹è¯•ç°æœ‰åŠŸèƒ½**ï¼ˆå¿…é¡»ï¼ï¼‰ï¼šéªŒè¯æ™®é€š `--urls` æ¨¡å¼æ­£å¸¸

**æ­¥éª¤ 5ï¼šæ–‡æ¡£æ›´æ–°**ï¼ˆå¿…é¡»æ‰§è¡Œï¼‰

ä½¿ç”¨ **Edit å·¥å…·**æŒ‰ä»¥ä¸‹æ ‡å‡†åˆ¤æ–­å¹¶æ›´æ–°ï¼š

| æ–‡æ¡£ | åˆ¤æ–­ç»“æœ | åŸå›  |
|------|----------|------|
| **CHANGELOG.md** | éœ€è¦æ›´æ–° | æ–°å¢åŠŸèƒ½ |
| **README.md** | éœ€è¦æ›´æ–° | æ–°å¢ç”¨æˆ·å¯è§çš„ CLI å‚æ•° `--with-images` |
| **CLAUDE.md** | éœ€è¦æ›´æ–° | æ–°å¢å‘½ä»¤è¡Œä½¿ç”¨ç¤ºä¾‹ |

**CHANGELOG.md æ›´æ–°**ï¼ˆåœ¨ `## [Unreleased]` ä¸‹æ·»åŠ ï¼‰ï¼š
```markdown
### Added
- **CLI**ï¼šæ–°å¢ `--with-images` å‚æ•°ï¼Œåœ¨ `--urls` æ¨¡å¼ä¸‹æå–é¡µé¢å›¾ç‰‡é“¾æ¥
  - å¿…é¡»é…åˆ `--urls` ä½¿ç”¨
  - è¾“å‡º JSON ä¸­æ–°å¢ `images` å­—æ®µ
  - ç›¸å…³æ–‡ä»¶ï¼š`src/cli_parser.py`, `src/url_list_mode.py`
```

**README.md æ›´æ–°**ï¼ˆåœ¨ `--urls` ç›¸å…³è¯´æ˜å¤„æ·»åŠ ï¼‰ï¼š
```markdown
# æå–å›¾ç‰‡é“¾æ¥
python creeper.py --urls "URL1,URL2" --with-images
```

**CLAUDE.md æ›´æ–°**ï¼ˆåœ¨"è¿è¡Œçˆ¬è™«"å‘½ä»¤ç¤ºä¾‹å¤„æ·»åŠ ï¼‰ï¼š
```markdown
# URLåˆ—è¡¨æ¨¡å¼ + æå–å›¾ç‰‡é“¾æ¥
python creeper.py --urls "URL1,URL2" --with-images
```

**æ­¥éª¤ 6ï¼šæäº¤ä»£ç **ï¼ˆå¿…é¡»æ‰§è¡Œï¼‰

ä½¿ç”¨ **Bash å·¥å…·**æ‰§è¡Œï¼š
```bash
git add .
git commit -m "feat: æ–°å¢ --with-images å‚æ•°æ”¯æŒæå–å›¾ç‰‡é“¾æ¥

ğŸ¤– Generated with [Claude Code](https://claude.com/claude-code)

Co-Authored-By: Claude <noreply@anthropic.com>"
```

**æ­¥éª¤ 7ï¼šè‡ªæˆ‘æ£€æŸ¥**
- [ ] æ–°åŠŸèƒ½æ˜¯å¦æŒ‰éœ€æ±‚æ­£å¸¸å·¥ä½œ
- [ ] ç°æœ‰åŠŸèƒ½æ˜¯å¦æ­£å¸¸ï¼ˆæœªè¢«ç ´åï¼‰
- [ ] CHANGELOG.md æ˜¯å¦å·²æ›´æ–°
- [ ] README.md æ˜¯å¦æŒ‰æ ‡å‡†åˆ¤æ–­å¹¶æ›´æ–°
- [ ] CLAUDE.md æ˜¯å¦æŒ‰æ ‡å‡†åˆ¤æ–­å¹¶æ›´æ–°
- [ ] "å®ç°æ­¥éª¤"ä¸"éœ€è¦ä¿®æ”¹/æ–°å¢çš„æ–‡ä»¶"æ˜¯å¦ä¸€è‡´
- [ ] æ‰€æœ‰ç›¸å…³æ–‡ä»¶æ˜¯å¦å·²æäº¤

---

## ä½¿ç”¨æ–¹å¼

### å‘½ä»¤è¡Œ
```bash
# URLåˆ—è¡¨æ¨¡å¼ + æå–å›¾ç‰‡é“¾æ¥
python creeper.py --urls "https://example.com" --with-images

# å¤šä¸ªURL
python creeper.py --urls "https://example1.com,https://example2.com" --with-images

# ç»“åˆå¹¶å‘æ•°è®¾ç½®
python creeper.py --urls "URL1,URL2" --with-images -c 10

# é”™è¯¯ç”¨æ³•ï¼ˆä¼šæç¤ºé”™è¯¯ï¼‰
python creeper.py inputs/input.md --with-images  # é”™è¯¯ï¼š--with-images ä»…åœ¨ --urls æ¨¡å¼ä¸‹ç”Ÿæ•ˆ
```

### è¾“å‡ºæ ¼å¼
```json
[
  {
    "title": "é¡µé¢æ ‡é¢˜",
    "summary": "é¡µé¢æè¿°",
    "content": "æå–çš„æ­£æ–‡å†…å®¹",
    "url": "https://example.com",
    "images": [
      "https://example.com/images/logo.png",
      "https://example.com/images/banner.jpg"
    ]
  }
]
```

### ä¸ä½¿ç”¨ `--with-images` æ—¶çš„è¾“å‡ºï¼ˆä¿æŒåŸæ ·ï¼‰
```json
[
  {
    "title": "é¡µé¢æ ‡é¢˜",
    "summary": "é¡µé¢æè¿°",
    "content": "æå–çš„æ­£æ–‡å†…å®¹",
    "url": "https://example.com"
  }
]
```

---

## æ³¨æ„äº‹é¡¹

**æŠ€æœ¯é£é™©**ï¼š
- **æ— æ–°ä¾èµ–å†²çª**ï¼šå¤ç”¨ç°æœ‰ `image_downloader.py` çš„å›¾ç‰‡æå–é€»è¾‘
- **æ€§èƒ½å½±å“æå°**ï¼šä»…å¢åŠ ä¸€æ¬¡æ­£åˆ™åŒ¹é…æ“ä½œ

**å…¼å®¹æ€§**ï¼š
- âœ… **å‘åå…¼å®¹**ï¼šä¸ä½¿ç”¨ `--with-images` æ—¶è¾“å‡ºæ ¼å¼ä¸å˜
- âœ… **æ— éœ€è¿ç§»**ï¼šç°æœ‰è„šæœ¬æ— éœ€ä¿®æ”¹
- âœ… **å‚æ•°éªŒè¯**ï¼šå•ç‹¬ä½¿ç”¨ `--with-images` ä¼šæç¤ºé”™è¯¯ï¼Œé¿å…è¯¯ç”¨

**è¾¹ç•Œæƒ…å†µå¤„ç†**ï¼š
- é¡µé¢æ— å›¾ç‰‡æ—¶ï¼Œ`images` å­—æ®µä¸ºç©ºæ•°ç»„ `[]`
- å›¾ç‰‡æå–å¤±è´¥æ—¶ï¼Œä¸å½±å“å…¶ä»–å­—æ®µçš„æ­£å¸¸è¾“å‡º
- ç›¸å¯¹è·¯å¾„å›¾ç‰‡ä¼šè¢«è½¬æ¢ä¸ºç»å¯¹è·¯å¾„ï¼ˆåŸºäºé¡µé¢ URLï¼‰
