# 错误修复：多URL保存到同一文件问题

**修复时间**：2025-12-08
**错误级别**：High

## 问题详情

### 错误信息
```
输出目录: outputs
生成文件: 1 个 其实只生成了一个文件.
```

### 错误类型
- 类型：文件覆盖问题（逻辑错误）
- 状态码：逻辑错误

## 问题分析

### 根本原因
`StorageManager.save_async` 方法中的文件命名逻辑使用了 `item.h2`（H2标题）作为文件名，导致同一H2下的多个URL都会保存到同一个文件，后面的内容会覆盖前面的内容。

### 问题代码
```python
# 错误的文件命名逻辑（save_async 方法）
filename = f"{sanitize_filename(item.h2)}.md"
```

### 影响范围
- 同一H2标题下的多个URL只能保存最后一个
- 大量网页内容丢失
- 爬取数据不完整

## 解决方案

### 修改文件
- `src/storage.py`：修复异步保存方法的文件命名逻辑

### 代码变更
```python
// 修改前 - src/storage.py:168
filename = f"{sanitize_filename(item.h2)}.md"

// 修改后 - src/storage.py:168
filename = sanitize_filename(page.title) + ".md"
```

### 设计原则
- 使用网页标题作为文件名，确保每个URL都有唯一的文件
- 与同步版本（save方法）保持一致的命名策略
- 使用sanitize_filename函数处理特殊字符

## 验证结果
- [x] 文件覆盖问题已修复
- [x] 每个URL生成唯一的文件名
- [x] 文件命名逻辑与同步版本一致

## 测试数据
修复后，4个URL应该生成以下文件：
1. `日本/日本军事扩张/高市早苗涉台言论错误-中国外交.md`
2. `日本/日本军事扩张/高市下台-中国日报.md`
3. `日本/日本军事扩张/对日反制升级-中新网.md`
4. `日本/日本军事扩张/高市涉台言论国内质疑-中新网.md`

## 相关上下文
这个问题在删除同步版本后暴露出来，因为之前可能用户主要使用同步模式。统一使用异步模式后，需要确保两个版本的行为完全一致。