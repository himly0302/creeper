# Claude Code 最佳实践 • Anthropic

> 📅 **爬取时间**: 2025-11-28 14:12:27
> 🔗 **来源链接**: https://fisherdaddy.com/posts/claude-code-best-practices/
> 📝 **网页描述**: Claude Code 是一款用于自主编码的命令行工具。这篇文章涵盖了一些技巧和窍门，这些技巧和窍门已被证明在使用 Claude Code 处理各种代码库、语言和环境时非常有效。
> ✍️ **作者**: Fisherdaddy
> 📆 **发布时间**: 2025-11-16
> 🎯 **爬取方式**: 静态爬取

---

本文由 Claude Code 负责人 Boris Cherny 所写：Claude Code: Best practices for agentic coding。本文档概述了高效使用 `Claude Code`

这一命令行编程工具的最佳实践。`Claude Code`

作为一个灵活、低阶的编程助手，旨在通过提供接近原始模型的访问能力，帮助工程师将其深度集成到开发工作流中。以下是核心观点和关键实践的总结。

## 关键细节

### 1. 环境定制与配置

**创建**：在项目根目录、父/子目录或用户主目录 (`CLAUDE.md`

文件`~/.claude/CLAUDE.md`

) 中创建此文件，用于提供项目特定的上下文，如常用命令、代码规范、测试指令等。Claude 会自动加载这些信息。**优化**：像优化提示词一样迭代`CLAUDE.md`

`CLAUDE.md`

文件，保持其简洁有效。可以使用`#`

键快速添加指令到该文件中。**管理工具权限**：通过会话中选择 “Always allow”、使用`/permissions`

命令或编辑配置文件，自定义工具的白名单，以在安全和效率之间取得平衡。**安装**：若使用`gh CLI`

`GitHub`

，安装`gh`

命令行工具能让`Claude`

更高效地进行创建`issue`

、提交`PR`

等操作。

### 2. 扩展 Claude 的工具集

**利用**：`bash`

工具`Claude`

可以直接使用您环境中的`bash`

工具和自定义脚本，只需告知其工具名称和用法。**使用**：通过连接到`MCP`

(Model Context Protocol)`MCP`

服务器，`Claude`

可以使用更复杂的外部工具，如`Puppeteer`

或`Sentry`

。**自定义斜杠命令**：在`.claude/commands`

目录下创建`Markdown`

文件来定义重复性工作流的模板，并通过`/`

命令调用。

### 3. 有效的工作流程模式

**探索、规划、编码、提交**：在处理复杂问题时，先让`Claude`

阅读相关文件进行研究，然后使用 “think” 指令让其制定详细计划，待计划确认后再执行编码。**测试驱动开发 (TDD)**：先让`Claude`

编写测试用例并确认其失败，然后编写能通过这些测试的代码，实现逐步迭代。**基于视觉反馈迭代**：提供设计图或界面截图作为目标，让`Claude`

编写代码、获取运行结果截图，并不断迭代直至与目标一致。**代码库问答 (Q&A)**：在熟悉新项目时，向`Claude`

提问，它能像结对编程的同事一样，通过搜索代码库来回答关于架构、功能实现等问题。**与**：利用`git`

和`GitHub`

交互`Claude`

自动完成`git`

历史搜索、编写提交信息、解决合并冲突以及创建`PR`

、修复代码审查评论等任务。

### 4. 优化日常工作流

**提供明确指令**：指令越具体，`Claude`

的首次成功率越高。避免模糊不清的要求。**利用视觉信息**：通过粘贴、拖拽或提供文件路径的方式给`Claude`

发送图片、图表和设计稿，以获得更精确的输出。**及早修正**：在`Claude`

执行任务时保持监督，使用`Escape`

键中断其当前操作以进行方向调整。**清理上下文**：在任务切换时，使用`/clear`

命令清空上下文窗口，避免无关信息干扰，提高其专注度和性能。**使用清单和暂存盘**：对于迁移、修复大量`lint`

错误等复杂任务，让`Claude`

将步骤和错误记录在一个`Markdown`

文件中，并逐项处理。

### 5. 高级用法

**无头模式 (Headless Mode)**：使用`-p`

标志在非交互式环境（如`CI`

、`git`

钩子）中运行`Claude`

，实现自动化任务，例如对新创建的`GitHub issue`

自动分类。**多**：同时运行多个`Claude`

协同工作`Claude`

实例，一个负责编写代码，另一个负责审查或测试，以此模拟团队协作，提高产出质量。**使用**：为同一个仓库创建多个工作区，让不同的`git worktrees`

`Claude`

实例在隔离的环境中并行处理不相关的任务，提高效率。

# 原文：Claude Code：代理式编码最佳实践

发布于 2025 年 4 月 18 日

Claude Code 是一款用于代理式编码的命令行工具。本文介绍了一些在使用 Claude Code 跨越不同代码库、语言和环境时被证明行之有效的技巧和窍门。

我们最近发布了 Claude Code，这是一款用于代理式编码的命令行工具。作为一个研究项目开发的 Claude Code，为 Anthropic 的工程师和研究人员提供了一种更原生的方式，将 Claude 集成到他们的编码工作流中。

Claude Code 故意设计为低级别和无主见的，提供近乎原始的模型访问，而不强迫特定的工作流。这种设计理念创造了一个灵活、可定制、可编写脚本且安全的强大工具。虽然功能强大，但这种灵活性给刚接触代理式编码工具的工程师带来了一个学习曲线——至少在他们形成自己的最佳实践之前是这样。

本文概述了在 Anthropic 内部团队和外部工程师在各种代码库、语言和环境中使用 Claude Code 时被证明有效的一般模式。这份清单中的任何内容都不是一成不变的，也不是普遍适用的；请将这些建议视为起点。我们鼓励您进行实验，找到最适合您的方法！

*正在寻找更详细的信息？我们在 claude.ai/code 上的综合文档* *涵盖了本文中提到的所有功能，并提供了额外的示例、实现细节和高级技术。*

## 1. 自定义您的设置

Claude Code 是一款代理式编码助手，可自动将上下文拉入提示。这种上下文收集会消耗时间和 token，但您可以通过环境调整来优化它。

### a. 创建 `CLAUDE.md`

文件

`CLAUDE.md`

是一个特殊文件，Claude 会在开始对话时自动将其拉入上下文。这使其成为记录以下内容的理想场所：

- 常用的 bash 命令
- 核心文件和实用函数
- 代码风格指南
- 测试说明
- 仓库礼仪（例如，分支命名、merge vs. rebase 等）
- 开发者环境设置（例如，pyenv 的使用、哪些编译器有效）
- 特定于项目的任何意外行为或警告
- 您希望 Claude 记住的其他信息

`CLAUDE.md`

文件没有必需的格式。我们建议保持其简洁易读。例如：

```
# Bash 命令
- npm run build：构建项目
- npm run typecheck：运行类型检查器
# 代码风格
- 使用 ES 模块 (import/export) 语法，而不是 CommonJS (require)
- 尽可能解构导入 (例如 import { foo } from 'bar')
# 工作流
- 在完成一系列代码更改后，请务必进行类型检查
- 出于性能考虑，首选运行单个测试，而不是整个测试套件
```

您可以将 `CLAUDE.md`

文件放置在几个位置：

**您仓库的根目录**，或您运行`claude`

的任何位置（最常见的用法）。将其命名为`CLAUDE.md`

并将其签入 git，以便您可以在会话之间以及与团队共享（推荐），或者将其命名为`CLAUDE.local.md`

并将其`.gitignore`

**您运行**。这对于 monorepo 最有用，您可能从`claude`

的目录的任何父目录`root/foo`

运行`claude`

，并在`root/CLAUDE.md`

和`root/foo/CLAUDE.md`

中都有`CLAUDE.md`

文件。这两个文件都会自动被拉入上下文**您运行**。这与上述情况相反，在这种情况下，当您处理子目录中的文件时，Claude 会按需拉入`claude`

的目录的任何子目录`CLAUDE.md`

文件**您的主文件夹**(`~/.claude/CLAUDE.md`

)，它适用于您所有的*claude*会话

当您运行 `/init`

命令时，Claude 会自动为您生成一个 `CLAUDE.md`

。

### b. 调整您的 `CLAUDE.md`

文件

您的 `CLAUDE.md`

文件会成为 Claude 提示的一部分，因此应像任何经常使用的提示一样对其进行优化。一个常见的错误是添加大量内容而不迭代其有效性。花时间进行实验，确定什么能让模型最好地遵循指令。

您可以手动向 `CLAUDE.md`

添加内容，或者按 `#`

键向 Claude 发出指令，它会自动将该指令合并到相关的 `CLAUDE.md`

中。许多工程师在编码时经常使用 `#`

来记录命令、文件和风格指南，然后在提交中包含 `CLAUDE.md`

更改，以便团队成员也能受益。

在 Anthropic，我们偶尔会通过提示改进器运行 `CLAUDE.md`

文件，并经常调整指令（例如使用“IMPORTANT”或“YOU MUST”添加强调）以提高遵循度。

![xx](images/image-5268e16cf684-1.webp)

### c. 管理 Claude 的允许工具列表

默认情况下，Claude Code 会对任何可能修改您系统的操作请求许可：文件写入、许多 bash 命令、MCP 工具等。我们设计 Claude Code 时采用了这种故意保守的方法，以优先考虑安全性。您可以自定义允许列表，以允许您知道是安全的额外工具，或者允许易于撤销的潜在不安全工具（例如，文件编辑、`git commit`

）。

有四种方法可以管理允许的工具：

**在会话期间提示时选择“始终允许”**。**启动 Claude Code 后使用**从允许列表中添加或删除工具。例如，您可以添加`/permissions`

命令`Edit`

以始终允许文件编辑，`Bash(git commit:*)`

以允许 git 提交，或`mcp__puppeteer__puppeteer_navigate`

以允许使用 Puppeteer MCP 服务器进行导航。**手动编辑**您的`.claude/settings.json`

或`~/.claude.json`

（我们建议将前者签入源代码控制以与您的团队共享）*.***使用**获取特定会话的权限。`--allowedTools`

CLI 标志

### d. 如果使用 GitHub，请安装 gh CLI

Claude 知道如何使用 `gh`

CLI 与 GitHub 交互，以创建 issue、打开拉取请求、读取评论等。如果未安装 `gh`

，Claude 仍然可以使用 GitHub API 或 MCP 服务器（如果您已安装）。

## 2. 为 Claude 提供更多工具

Claude 可以访问您的 shell 环境，您可以在其中为它构建便利脚本和函数集，就像为您自己构建一样。它还可以通过 MCP 和 REST API 利用更复杂的工具。

### a. 将 Claude 与 bash 工具结合使用

Claude Code 继承您的 bash 环境，使其可以访问您的所有工具。虽然 Claude 知道像 unix 工具和 `gh`

这样的常用实用程序，但没有指令它不会知道您的自定义 bash 工具：

- 告诉 Claude 工具名称和使用示例
- 告诉 Claude 运行
`--help`

查看工具文档 - 在
`CLAUDE.md`

中记录常用工具

### b. 将 Claude 与 MCP 结合使用

Claude Code 可同时用作 MCP 服务器和客户端。作为客户端，它可以通过三种方式连接到任意数量的 MCP 服务器以访问其工具：

**在项目配置中**（在该目录中运行 Claude Code 时可用）**在全局配置中**（在所有项目中可用）**在签入的**（在您的代码库中工作的任何人都可以使用）。例如，您可以将 Puppeteer 和 Sentry 服务器添加到您的`.mcp.json`

文件中`.mcp.json`

中，以便在您的仓库中工作的每位工程师都可以开箱即用这些工具。

使用 MCP 时，使用 `--mcp-debug`

标志启动 Claude 也有助于识别配置问题。

### c. 使用自定义斜杠命令

对于重复的工作流——调试循环、日志分析等——将提示模板存储在 `.claude/commands`

文件夹中的 Markdown 文件中。当您键入 `/`

时，这些命令可通过斜杠命令菜单使用。您可以将这些命令签入 git，使其对您的团队其他成员可用。

自定义斜杠命令可以包含特殊关键字 `$ARGUMENTS`

，以从命令调用中传递参数。

例如，这是一个可用于自动拉取和修复 Github issue 的斜杠命令：

```
请分析并修复 GitHub issue：$ARGUMENTS。
请遵循以下步骤：
1. 使用 `gh issue view` 获取 issue 详细信息
2. 理解 issue 中描述的问题
3. 在代码库中搜索相关文件
4. 实现必要的更改以修复 issue
5. 编写并运行测试以验证修复
6. 确保代码通过 linting 和类型检查
7. 创建描述性的提交消息
8. 推送并创建 PR
请记住使用 GitHub CLI (`gh`) 处理所有与 GitHub 相关的任务。
```

将上述内容放入 `.claude/commands/fix-github-issue.md`

中，使其在 Claude Code 中可用作 `/project:fix-github-issue`

命令。然后您就可以使用例如 `/project:fix-github-issue 1234`

来让 Claude 修复 issue #1234。同样，您可以将自己的个人命令添加到 `~/.claude/commands`

文件夹中，以便在所有会话中使用。

## 3. 尝试常见的工作流

Claude Code 并不强加特定的工作流，让您可以灵活地按自己想要的方式使用它。在这种灵活性提供的空间内，我们的用户社区中出现了几种有效使用 Claude Code 的成功模式：

### a. 探索、计划、编码、提交

这个通用的工作流适用于许多问题：

**要求 Claude 阅读相关文件、图像或 URL**，提供一般性指引（“阅读处理日志记录的文件”）或特定文件名（“阅读 logging.py”），但明确告诉它暂时不要编写任何代码。- 这是工作流中应考虑大量使用子代理（subagent）的部分，尤其是对于复杂问题。告诉 Claude 使用子代理来验证细节或调查它可能有的特定问题，尤其是在对话或任务的早期阶段，往往可以在不损失太多效率的情况下保持上下文的可用性。

**要求 Claude 制定一个解决特定问题的计划**。我们建议使用“think”（思考）这个词来触发扩展思考模式，这为 Claude 提供了额外的计算时间来更彻底地评估备选方案。这些特定短语直接映射到系统中不断增加的思考预算级别：“think”<“think hard”<“think harder”<“ultrathink”。每个级别都会分配逐渐增多的思考预算供 Claude 使用。- 如果此步骤的结果看起来合理，您可以让 Claude 创建一个文档或 GitHub issue 及其计划，以便如果实现（步骤 3）不是您想要的，您可以重置到这个位置。

**要求 Claude 在代码中实现其解决方案**。这也是要求它在实现解决方案的各个部分时明确验证其解决方案合理性的好时机。**要求 Claude 提交结果并创建拉取请求**。如果相关，这也是让 Claude 更新任何 README 或变更日志，解释它刚刚做了什么的好时机。

步骤 #1-#2 至关重要——没有它们，Claude 倾向于直接跳到编码解决方案。虽然有时这正是您想要的，但要求 Claude 先研究和计划，可以显著提高处理需要预先深入思考的问题的性能。

### b. 编写测试、提交；编码、迭代、提交

这是 Anthropic 最喜欢的工作流，适用于易于通过单元、集成或端到端测试验证的更改。测试驱动开发 (TDD) 在代理式编码下变得更加强大：

**要求 Claude 基于预期的输入/输出对编写测试**。明确指出您正在进行测试驱动开发，以便它避免创建模拟实现，即使是对于代码库中尚不存在的功能。**告诉 Claude 运行测试并确认它们失败**。在此阶段明确告诉它不要编写任何实现代码通常很有帮助。**当您对测试满意时，要求 Claude 提交测试**。**要求 Claude 编写通过测试的代码**，指示它不要修改测试。告诉 Claude 继续，直到所有测试都通过。Claude 通常需要几次迭代才能编写代码、运行测试、调整代码并再次运行测试。- 在这个阶段，要求它通过独立的子代理验证实现是否过度拟合测试会很有帮助。

**一旦您对更改满意，要求 Claude 提交代码**。

当 Claude 有一个明确的目标可以迭代时，它表现最好——一个视觉模型、一个测试用例或另一种输出。通过提供像测试这样的预期输出，Claude 可以进行更改、评估结果并逐步改进，直到成功。

### c. 编写代码、截图结果、迭代

与测试工作流类似，您可以为 Claude 提供视觉目标：

**为 Claude 提供一种截取浏览器截图的方法**（例如，使用 Puppeteer MCP 服务器、iOS 模拟器 MCP 服务器，或手动将截图复制/粘贴给 Claude）。**通过复制/粘贴或拖放图像，或为 Claude 提供图像文件路径，为 Claude 提供一个视觉模型**。**要求 Claude 在代码中实现设计**，截取结果图，并迭代，直到其结果与模型匹配。**当您满意时，要求 Claude 提交**。

像人类一样，Claude 的输出往往会随着迭代而显著改善。虽然第一个版本可能不错，但经过 2-3 次迭代后，它通常会看起来好得多。为 Claude 提供工具以查看其输出，以获得最佳结果。

![xxx](images/image-85b26b7155ba-1.webp)

### d. 安全 YOLO 模式

您可以使用 `claude --dangerously-skip-permissions`

来绕过所有权限检查，让 Claude 不间断地工作直到完成，而不是监督 Claude。这适用于修复 lint 错误或生成样板代码等工作流。

让 Claude 运行任意命令是有风险的，可能导致数据丢失、系统损坏，甚至数据泄露（例如，通过提示注入攻击）。为了最大限度地降低这些风险，请在没有互联网访问的容器中使用 `--dangerously-skip-permissions`

。您可以遵循这个使用 Docker Dev Containers 的参考实现。

### e. 代码库问答

在熟悉新代码库时，使用 Claude Code 进行学习和探索。您可以向 Claude 提出在结对编程时会向项目中的其他工程师提出的同类问题。Claude 可以代理式搜索代码库以回答一般性问题，例如：

- 日志记录是如何工作的？
- 我如何创建一个新的 API 端点？
`foo.rs`

第 134 行的`async move { ... }`

是做什么的？`CustomerOnboardingFlowImpl`

处理了哪些边缘情况？- 为什么我们在第 333 行调用
`foo()`

而不是`bar()`

？ `baz.py`

第 334 行在 Java 中对应什么？

在 Anthropic，以这种方式使用 Claude Code 已成为我们的核心入职工作流，显著缩短了熟悉时间并减少了其他工程师的负担。不需要特殊的提示！只需提问，Claude 就会探索代码以找到答案。

![xx](images/image-710b31dff2c6-1.webp)

### f. 使用 Claude 与 git 交互

Claude 可以有效处理许多 git 操作。许多 Anthropic 工程师使用 Claude 进行 90% 以上的 *git* 交互：

**搜索**以回答诸如“v1.2.3 版本中包含了哪些更改？”、“谁负责这个特定功能？”或“为什么这个 API 是这样设计的？”等问题。明确提示 Claude 查阅 git 历史记录以回答此类查询会很有帮助。*git*历史记录**编写提交消息**。Claude 会自动查看您的更改和最近的历史记录，以撰写一条考虑了所有相关上下文的消息**处理复杂的 git 操作**，如恢复文件、解决 rebase 冲突以及比较和嫁接补丁

### g. 使用 Claude 与 GitHub 交互

Claude Code 可以管理许多 GitHub 交互：

**创建拉取请求**：Claude 理解“pr”这个速记词，并将根据差异和周围上下文生成适当的提交消息。**为简单的代码审查评论实施一次性解决方案**：只需告诉它修复您 PR 上的评论（可选地，给它更具体的指示），并在完成后推送回 PR 分支。**修复失败的构建**或 linter 警告**分类和分流开放的 issue**，通过要求 Claude 循环遍历开放的 GitHub issue

这消除了记住 `gh`

命令行语法的需要，同时自动化了日常任务。

### h. 使用 Claude 处理 Jupyter 笔记本

Anthropic 的研究人员和数据科学家使用 Claude Code 来读取和编写 Jupyter 笔记本。Claude 可以解释输出，包括图像，提供了一种探索和与数据交互的快速方法。没有必需的提示或工作流，但我们推荐的一个工作流是在 VS Code 中并排打开 Claude Code 和一个 `.ipynb`

文件。

您还可以要求 Claude 在向同事展示之前清理或美化您的 Jupyter 笔记本。明确告诉它使笔记本或其数据可视化“美观”有助于提醒它正在为人类观看体验进行优化。

## 4. 优化您的工作流

以下建议适用于所有工作流：

### a. 在您的指令中要具体

Claude Code 的成功率会随着更具体的指令而显著提高，尤其是在首次尝试时。预先给出明确的指示可以减少以后纠正的需要。

例如：

| 差 | 好 |
|---|---|
| 为 foo.py 添加测试 | 为 foo.py 编写一个新的测试用例，覆盖用户未登录的边缘情况。避免使用模拟（mock） |
| 为什么 ExecutionFactory 的 api 这么奇怪？ | 查看 ExecutionFactory 的 git 历史记录，总结其 api 是如何演变而来的 |
| 添加一个日历小部件 | 查看主页上现有小部件的实现方式，以了解模式，特别是代码和接口是如何分离的。HotDogWidget.php 是一个很好的起点示例。然后，遵循该模式实现一个新的日历小部件，让用户可以选择月份并向前/向后翻页以选择年份。除了代码库中已使用的库之外，不要使用其他库从头开始构建。 |

Claude 可以推断意图，但它不会读心术。具体性带来更好的一致性预期。

![xxx](images/image-2fe19dd9580a-1.webp)

### b. 为 Claude 提供图像

Claude 通过多种方法出色地处理图像和图表：

**粘贴截图**（专业提示：在 macOS 中按*cmd+ctrl+shift+4*截屏到剪贴板，按*ctrl+v*粘贴。请注意，这不是您通常在 mac 上粘贴时使用的 cmd+v，并且远程无效。）**将图像直接拖放**到提示输入中**提供图像的文件路径**

这在处理设计模型作为 UI 开发的参考点，以及用于分析和调试的可视化图表时特别有用。如果您没有向上下文中添加视觉效果，向 Claude 明确说明结果在视觉上具有吸引力的重要性仍然会有所帮助。

![xxx](images/image-bd384f1623a9-1.webp)

### c. 提及您希望 Claude 查看或处理的文件

使用 tab 键自动补全功能，快速引用仓库中任何地方的文件或文件夹，帮助 Claude 找到或更新正确的资源。

![xx](images/image-519ec3ee1ef9-1.webp)

### d. 为 Claude 提供 URL

将特定 URL 与您的提示一起粘贴，供 Claude 获取和阅读。为避免对相同域（例如 docs.foo.com）的权限提示，请使用 `/permissions`

将域添加到您的允许列表中。

### e. 尽早并经常纠正

虽然自动接受模式（按 shift+tab 切换）可让 Claude 自主工作，但通过作为积极的协作者并指导 Claude 的方法，您通常会获得更好的结果。您可以通过在开始时向 Claude 彻底解释任务来获得最佳结果，但您也可以随时纠正 Claude。

这四种工具有助于纠正：

**在编码前要求 Claude 制定计划**。明确告诉它在您确认其计划看起来不错之前不要编码。**在任何阶段（思考、工具调用、文件编辑）按 Escape 键中断**Claude，同时保留上下文，以便您可以重定向或扩展指令。**双击 Escape 键跳回历史记录**，编辑先前的提示，并探索不同的方向。您可以编辑提示并重复，直到获得所需的结果。**要求 Claude 撤销更改**，通常与选项 #2 结合使用以采取不同的方法。

尽管 Claude Code 偶尔会在第一次尝试时就完美解决问题，但使用这些纠正工具通常会更快地产生更好的解决方案。

### f. 使用 `/clear`

保持上下文集中

在长时间会话期间，Claude 的上下文窗口可能会填满无关的对话、文件内容和命令。这会降低性能，有时会分散 Claude 的注意力。在任务之间经常使用 `/clear`

命令重置上下文窗口。

### g. 对复杂工作流使用清单和草稿板

对于具有多个步骤或需要详尽解决方案的大型任务——例如代码迁移、修复大量 lint 错误或运行复杂的构建脚本——通过让 Claude 使用 Markdown 文件（甚至 GitHub issue！）作为清单和工作草稿板来提高性能：

例如，要修复大量的 lint 问题，您可以执行以下操作：

**告诉 Claude 运行 lint 命令**并将所有导致的错误（包含文件名和行号）写入 Markdown 清单**指示 Claude 逐个解决每个问题**，在检查并标记完成之前进行修复和验证

### h. 将数据传递给 Claude

有几种方法可以向 Claude 提供数据：

**直接复制并粘贴**到您的提示中（最常见的方法）**通过管道传入 Claude Code**（例如`cat foo.txt | claude`

），特别适用于日志、CSV 和大数据**告诉 Claude 通过 bash 命令、MCP 工具或自定义斜杠命令**拉取数据**要求 Claude 读取文件**或获取 URL（也适用于图像）

大多数会话都涉及这些方法的组合。例如，您可以通过管道传入一个日志文件，然后告诉 Claude 使用工具拉入额外的上下文来调试日志。

## 5. 使用无头 (headless) 模式自动化您的基础架构

Claude Code 包含无头模式，适用于 CI、预提交钩子 (pre-commit hook)、构建脚本和自动化等非交互式上下文。将 `-p`

标志与提示一起使用以启用无头模式，并使用 `--output-format stream-json`

获取流式 JSON 输出。

请注意，无头模式在会话之间不会持久存在。您必须在每个会话中触发它。

### a. 使用 Claude 进行 issue 分流

无头模式可以为由 GitHub 事件触发的自动化提供支持，例如在您的仓库中创建新 issue 时。例如，公共的 Claude Code 仓库使用 Claude 检查新传入的 issue 并分配适当的标签。

### b. 使用 Claude 作为 linter

Claude Code 可以提供主观代码审查，超越传统 linting 工具的检测范围，识别拼写错误、过时的评论、误导性的函数或变量名等问题。

## 6. 通过多 Claude 工作流提升水平

除了独立使用之外，一些最强大的应用程序涉及并行运行多个 Claude 实例：

### a. 让一个 Claude 编写代码；使用另一个 Claude 进行验证

一个简单而有效的方法是让一个 Claude 编写代码，而另一个则审查或测试它。与多名工程师协作类似，有时分离的上下文是有益的：

- 使用 Claude 编写代码
- 运行
`/clear`

或在另一个终端中启动第二个 Claude - 让第二个 Claude 审查第一个 Claude 的工作
- 启动另一个 Claude（或再次
`/clear`

）以阅读代码和审查反馈 - 让这个 Claude 根据反馈编辑代码

您可以用测试做类似的事情：让一个 Claude 编写测试，然后让另一个 Claude 编写代码使测试通过。您甚至可以通过为它们提供单独的工作草稿板，并告诉它们写入哪一个和读取哪一个，来让您的 Claude 实例相互通信。

这种分离通常会比让单个 Claude 处理所有事情产生更好的结果。

### b. 拥有仓库的多个检出 (checkout)

Anthropic 的许多工程师不是等待 Claude 完成每一步，而是这样做：

**在单独的文件夹中创建 3-4 个 git 检出****在单独的终端选项卡中打开每个文件夹****在每个文件夹中启动 Claude**，分配不同的任务**循环查看**以检查进度并批准/拒绝权限请求

### c. 使用 git worktree

这种方法在处理多个独立任务时表现出色，提供了比多个检出更轻量级的替代方案。Git worktree 允许您将同一仓库的多个分支检出到单独的目录中。每个 worktree 都有自己独立文件的工作目录，同时共享相同的 Git 历史和 reflog。

使用 git worktree 使您能够同时在项目的不同部分上运行多个 Claude 会话，每个会话都专注于自己独立的任务。例如，您可能让一个 Claude 重构您的身份验证系统，而另一个则构建一个完全不相关的数据可视化组件。由于任务不重叠，每个 Claude 都可以全速工作，而无需等待对方的更改或处理合并冲突：

**创建 worktree**：`git worktree add ../project-feature-a feature-a`

**在每个 worktree 中启动 Claude**：`cd ../project-feature-a && claude`

**根据需要创建额外的 worktree**（在新的终端选项卡中重复步骤 1-2）

一些提示：

- 使用一致的命名约定
- 每个 worktree 保持一个终端选项卡
- 如果您在 Mac 上使用 iTerm2，设置通知以便在 Claude 需要注意时提醒您
- 为不同的 worktree 使用单独的 IDE 窗口
- 完成后清理：
`git worktree remove ../project-feature-a`

### d. 将无头模式与自定义工具链 (harness) 结合使用

`claude -p`

（无头模式）将 Claude Code 以编程方式集成到更大的工作流中，同时利用其内置工具和系统提示。使用无头模式主要有两种模式：

1. **扇出 (Fanning out)** 处理大型迁移或分析（例如，分析数百个日志中的情绪或分析数千个 CSV）：

- 让 Claude 编写一个脚本来生成任务列表。例如，生成一个需要从框架 A 迁移到框架 B 的 2000 个文件的列表。
- 循环遍历任务，为每个任务以编程方式调用 Claude，并为其提供一个任务和一组它可以使用的工具。例如：
`claude -p “将 foo.py 从 React 迁移到 Vue。完成后，如果成功，您必须返回字符串 OK，如果任务失败，则返回 FAIL。” --allowedTools Edit Bash(git commit:*)`

- 多次运行脚本并优化您的提示以获得期望的结果。

2. **流水线 (Pipelining)** 将 Claude 集成到现有的数据/处理流水线中：

- 调用
`claude -p “<您的提示>” --json | your_command`

，其中`your_command`

是您处理流水线的下一步 - 就是这样！JSON 输出（可选）可以帮助提供结构，以便于自动处理。

对于这两种用例，使用 `--verbose`

标志来调试 Claude 调用会很有帮助。我们通常建议在生产环境中关闭详细模式，以获得更简洁的输出。

您在使用 Claude Code 时有什么技巧和最佳实践？请标记 @AnthropicAI，让我们看看您在构建什么！

## 致谢

作者：Boris Cherny。这项工作借鉴了更广泛的 Claude Code 用户社区的最佳实践，他们的创造性方法和工作流继续激励着我们。特别感谢 Daisy Hollman、Ashwin Bhat、Cat Wu、Sid Bidasaria、Cal Rueb、Nodir Turakulov、Barry Zhang、Drew Hodun 以及许多其他 Anthropic 工程师，他们对 Claude Code 的宝贵见解和实践经验帮助塑造了这些建议。

---

*本文由 Creeper 自动爬取并清洗*